<!-- The Configuration Wizard -->
<section>
  <div class="row">
    <div class="col-xs-10 col-xs-offset-1">
      <h2>Browse Applications</h2>
      
      <ol class="breadcrumb">
        <li><a href="http://labsportal.nationaldataservice.org/">NDS Labs</a></li>
        <li class="active">Browse Applications</li>
      </ol>
      
      <!-- Application Search / Filter -->
      <div class="input-group">
        <span class="input-group-addon" id="searchHeader"><i class="fa fa-search"></i></span>
        <input type="text" class="form-control" placeholder="Filter applications..." ng-model="svcQuery" 
            aria-describedby="searchHeader" />
            
        <span class="input-group-addon">
          <input type="checkbox" ng-model="showStandalones" uib-tooltip="Show standalone services" tooltip-placement="top-right">
        </span>
        
        <div class="input-group-btn">
          <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            View As: {{ mode | capitalize }} <i class="fa fa-fw fa-chevron-down"></i>
          </button>
          <div class="dropdown-menu dropdown-menu-right">
            <a class="dropdown-item cursor-pointer" href="#/store" ng-click="mode = 'cards'">Cards</a>
            <a class="dropdown-item cursor-pointer" href="#/store" ng-click="mode = 'table'">Table</a>
          </div>
        </div>
      </div>
      
      <p class="text-center text-danger" ng-show="(specs | isStack:showStandalones | filter : svcQuery).length === 0">
        <small>No applications matched your search</small>
      </p>
      <p class="text-center text-success" ng-show="(specs | isStack:showStandalones | filter : svcQuery).length !== 0">
        <small>Choose an application below to configure</small>
      </p>
      
      <!-- Table -->
      <table ng-if="mode === 'table'" class="table table-hover table-striped" ng-hide="(specs | filter : svcQuery).length === 0">
        <thead>
          <tr>
            <th><label>Name</label></th>
            <th><label>Description</label></th>
            <th></th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="spec in specs | isStack:showStandalones | orderBy:'label' | filter : svcQuery track by spec.key">
            <td width="20%">
              {{ spec.label }}
            </td>
            <td width="50%">
              {{ spec.description }}
            </td>
            <td width="15%">
              <!-- Install button -->
              <button ng-if="installs[spec.key].progress === 0" ng-disabled="installs[spec.key].progress > 0" 
                  class="btn btn-xs btn-primary pull-right" ng-click="install(spec)">
                <span ng-if="installs[spec.key].count === 0">
                  <i class="fa fa-fw fa-hand-pointer-o"></i> Install
                </span>
                
                <span ng-if="installs[spec.key].count > 0">
                  <i class="fa fa-fw fa-repeat"></i> Install ({{ installs[spec.key].count }} installed)
                </span>
              </button>
              
              <!-- Show "install" progress -->
              <div class="progress" style="margin:3px;min-width:75px;" ng-if="installs[spec.key].progress > 0">
                <div class="progress-bar progress-bar-primary progress-bar-striped active" role="progressbar" aria-valuenow="{{ installs[spec.key].progress }}"
                    aria-valuemin="0" aria-valuemax="{{ installMax }}" style="width:{{ 100 * installs[spec.key].progress / installMax }}%;">
                  <span class="sr-only">{{ installs[spec.key].progress / installMax  }}% Complete</span>
                </div>
              </div>
            </td>
            <td width="5%">
              <button class="btn btn-xs btn-default pull-right" ng-click="goto('/home')" ng-if="installs[spec.key].count > 0">
                <i class="fa fa-fw fa-eye"></i> View
              </button>
            </td>
          </tr>
        </tbody>
      </table>
      
      <!-- Cards -->
      <div ng-if="mode === 'cards'" class="panel-body">
        <div class="row table-row" ng-repeat="set in chunkedSpecs">
          <div class="col-sm-3" ng-repeat="spec in set">
            <div class="thumbnail" ng-class="{ 'bg-primary': selectedSpec === spec}">
              <!--<img ng-if="spec.key === 'clowder'" height="44" width="200" src="https://medici.ncsa.illinois.edu/img/logo.png" alt="Clowder">
              <img ng-if="spec.key === 'dataverse'" height="44" width="200" src="http://www.worldagroforestry.org/open-access-week/img/logos/dataverse.png" alt="Dataverse">
              <img ng-if="spec.key === 'icat'" height="44" width="200"  src="http://bionics.it/site/assets/files/1050/irods-logo.200x0-is.png" alt="iRODS iCAT">
              <img ng-if="spec.key === 'kibana'" height="44" width="200" src="https://raw.githubusercontent.com/1science/docker-kibana/latest/logo.png" alt="Kibana">-->
              <div class="caption">
                <h4>{{ spec.label }}</h4>
                <p>{{ spec.description }}</p>
              </div>
              <div class="row">
                <div class="col-sm-7">
                  <button ng-if="installs[spec.key].progress === 0" ng-disabled="installs[spec.key].progress > 0" 
                      class="btn btn-xs btn-primary" ng-click="install(spec)" style="margin-bottom:11px;">
                    <span ng-if="installs[spec.key].count === 0">
                      <i class="fa fa-fw fa-hand-pointer-o"></i> Install
                    </span>
                    
                    <span ng-if="installs[spec.key].count > 0">
                      <i class="fa fa-fw fa-repeat"></i> Install ({{ installs[spec.key].count }} installed)
                    </span>
                  </button>
                  
                  <!-- Show "install" progress -->
                  <div class="progress" style="margin:0;padding:0;min-width:130px;" ng-if="installs[spec.key].progress > 0">
                    <div class="progress-bar progress-bar-primary progress-bar-striped active" role="progressbar" aria-valuenow="{{ installs[spec.key].progress }}"
                        aria-valuemin="0" aria-valuemax="{{ installMax }}" style="margin:0;width:{{ 100 * installs[spec.key].progress / installMax }}%;">
                      <span class="sr-only">{{ installs[spec.key].progress / installMax  }}% Complete</span>
                    </div>
                  </div>
                </div>
                <div class="col-sm-5">
                  <button class="btn btn-xs btn-default" ng-click="goto('/home')" ng-if="installs[spec.key].count > 0" style="margin:0 10px 11px 10px;">
                    <i class="fa fa-fw fa-eye"></i> View
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>  
  </div>
</section>
